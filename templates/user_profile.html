{% extends "base.html" %}
{% block title %} - 编辑个人资料{% endblock %}
{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-3">
            <!-- 左侧导航栏 -->
            <div class="list-group">
                <a href="{{ url_for('user_center') }}" class="list-group-item list-group-item-action">
                    <i class="fas fa-home me-2"></i>个人中心
                </a>
                <a href="{{ url_for('user_profile') }}" class="list-group-item list-group-item-action active">
                    <i class="fas fa-user-edit me-2"></i>编辑资料
                </a>
                <a href="{{ url_for('my_submissions') }}" class="list-group-item list-group-item-action">
                    <i class="fas fa-paper-plane me-2"></i>我的投稿
                </a>
                {% if not current_user.is_reviewer %}
                <a href="{{ url_for('apply_reviewer') }}" class="list-group-item list-group-item-action">
                    <i class="fas fa-user-check me-2"></i>申请审核人
                </a>
                {% endif %}
                <a href="{{ url_for('user_feedback') }}" class="list-group-item list-group-item-action">
                    <i class="fas fa-comment-dots me-2"></i>反馈建议
                </a>
                <a href="{{ url_for('logout') }}" class="list-group-item list-group-item-action text-danger">
                    <i class="fas fa-sign-out-alt me-2"></i>退出登录
                </a>
            </div>
        </div>
        
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">编辑个人资料</h4>
                </div>
                <div class="card-body">
                    
                    <form method="POST" action="{{ url_for('user_profile') }}" enctype="multipart/form-data">
                        <div class="row">
                            <!-- 左侧：头像区域 -->
                            <div class="col-md-4 text-center mb-4">
                                <div class="mb-3">
                                    <img src="{{ avatar_url }}" 
                                         alt="用户头像" class="img-thumbnail rounded-circle" width="150" height="150" id="avatarPreview">
                                </div>
                                <div class="mb-3">
                                    <label for="avatar" class="form-label">更换头像</label>
                                    <input type="file" class="form-control" id="avatar" name="avatar" accept="image/*" onchange="previewAvatar(event)">
                                    <div class="form-text">支持 JPG, PNG 格式，建议尺寸 150x150，最大5MB</div>
                                </div>
                            </div>
                            
                            <!-- 右侧：个人信息表单 -->
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="username" class="form-label">用户名</label>
                                    <input type="text" class="form-control" id="username" value="{{ user.username }}" readonly>
                                    <div class="form-text">用户名注册后不可修改</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="real_name" class="form-label">真实姓名</label>
                                    <input type="text" class="form-control" id="real_name" name="real_name" value="{{ user.real_name or '' }}">
                                    <div class="form-text">用于实名认证和投稿身份核实</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="email" class="form-label">电子邮箱 *</label>
                                    <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                                    <div class="form-text">用于接收重要通知和找回密码</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="phone" class="form-label">联系电话</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" value="{{ user.phone or '' }}">
                                    <div class="form-text">仅用于紧急联系，不会公开显示</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bio" class="form-label">个人简介</label>
                                    <textarea class="form-control" id="bio" name="bio" rows="4" placeholder="介绍一下自己吧，比如您的艺术兴趣、专业领域等">{{ user.bio or '' }}</textarea>
                                    <div class="form-text">个人简介将在您的投稿和评论中显示</div>
                                </div>
                                
                                <!-- 实名认证状态 -->
                                <div class="mb-3">
                                    <label class="form-label">实名认证状态</label>
                                    <div>
                                        {% if user.is_verified %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle me-1"></i>已认证
                                        </span>
                                        <div class="form-text">您已完成实名认证</div>
                                        {% else %}
                                        <span class="badge bg-warning text-dark">
                                            <i class="fas fa-exclamation-circle me-1"></i>未认证
                                        </span>
                                        <div class="form-text">您还未完成实名认证</div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- 审核人状态 -->
                                <div class="mb-3">
                                    <label class="form-label">审核人身份</label>
                                    <div>
                                        {% if user.is_reviewer %}
                                        <span class="badge bg-primary">
                                            <i class="fas fa-user-check me-1"></i>认证审核人
                                        </span>
                                        <div class="form-text">您拥有作品审核权限</div>
                                        {% else %}
                                        <span class="badge bg-secondary">
                                            <i class="fas fa-user me-1"></i>普通用户
                                        </span>
                                        <div class="form-text">您可以通过"申请审核人"功能申请审核权限</div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>保存修改
                                    </button>
                                    <a href="{{ url_for('user_center') }}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-1"></i>返回
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- 修改密码卡片（可选功能） -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">修改密码</h5>
                </div>
                <div class="card-body">
                    <p class="card-text">如需修改密码，请通过忘记密码功能或联系客服。</p>
                    <a href="#" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                        <i class="fas fa-key me-1"></i>修改密码
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 修改密码模态框 -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">修改密码</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    此功能正在开发中，如需修改密码请联系客服。
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function previewAvatar(event) {
    const reader = new FileReader();
    reader.onload = function() {
        const output = document.getElementById('avatarPreview');
        output.src = reader.result;
    };
    reader.readAsDataURL(event.target.files[0]);
}

// 页面加载完成后执行
document.addEventListener('DOMContentLoaded', function() {
    // 如果有错误信息，3秒后自动隐藏
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 3000);
});
</script>
{% endblock %}